<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Greg Finak gfinak@fredhutch.org" />

<meta name="date" content="2018-05-29" />

<title>Using DataPackageR</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Using DataPackageR</h1>
<h4 class="author"><em>Greg Finak <a href="mailto:gfinak@fredhutch.org">gfinak@fredhutch.org</a></em></h4>
<h4 class="date"><em>2018-05-29</em></h4>



<div id="datapackager" class="section level1">
<h1>DataPackageR</h1>
<p>Reproducibly process raw data into packaged, analysis-ready data sets</p>
<div id="goals" class="section level2">
<h2>Goals</h2>
<p>You have raw data that needs to be tidied and otherwise processed into a standardized analytic data set (a data set that is ready for analysis). You want to do the processing using best practices for reproducible research.</p>
<div id="the-current-state-of-affairs" class="section level3">
<h3>The current state of affairs</h3>
<p>Normally, you’ll write some code that does the tidying and outputs a tidy data set. If you want to distribute your data set, you can put it in an R package. The preferred mechanism is to place your data tidying code in <code>data-raw</code> in the package source tree and use the <code>devtools</code> package (specifically <code>devtools::use_data</code>) to save the data into the <code>data</code> directory. The build process will include your data set in the final package. You’ll also have to remember to document the data set in <code>roxygen</code>, and write a vignette showing how to use the data. For version control and easy distribution you might post the package on github.</p>
</div>
<div id="scaling-up" class="section level3">
<h3>Scaling up</h3>
<p>The process outlined works well for smaller data sets. It can be a hassle if you have complex data that change frequently (as is often the case in biology, where data trickle in from collaborators and follow-up experiments), or more generally if you have large data sets where raw data can’t be distributed as part of the package source due to size restrictions (e.g. FASTQ files for sequencing, FCS files for flow cytometry, or other “omics” data).</p>
</div>
<div id="datapackager-1" class="section level3">
<h3>DataPackageR</h3>
<p>The <code>DataPackageR</code> package simplifies bundling of code, data and documentation into a single R package that can be versioned and distributed. The <code>datapackage.skeleton()</code> API lets you point <code>DataPackageR</code> at your data processing code (in the form of Rmd and / or R files). These are expected to produce <code>data objects</code> to be stored in the final package. The names of these are also passed to <code>datapackage.skeleton()</code>. This produces the necessary package structure, and populations a <code>datapackager.yml</code> configuration file used by the build process.</p>
<p>The <code>buildDataSetPackage()</code> API runs the processing code specified in the <code>.yml</code> files and produces html reports of the processing as <strong>package vignettes</strong>. It also builds boilerplate <code>roxygen</code> documentation of the R objects specified in the <code>.yml</code>, computes checksums of stored R objects and version tags the entire data set collection.</p>
<p>If raw data changes, the user can rebuild the R package with subsequent calls to <code>buildDataSetPackage()</code> which will re-run the processing, compare the cheksums of new R objects against those currently stored in the package. Any changes force an increment of the <code>Dataversion</code> string in the package DESCRIPTION file. When the package is installed, data sets can be accessed via the standard <code>data()</code> API, package vignettes describing the data processing can be accessed via <code>vignette()</code>, documentation via <code>?</code>, and the data version via <code>dataVersion(packageName)</code>.</p>
</div>
</div>
<div id="usage" class="section level2">
<h2>Usage</h2>
<p>Set up a new data package.</p>
<p>We’ll set up a new data package that processes the <code>cars</code> data by subsetting it to include only cars with speed greater than or equal to 20 mph. It is processed using an Rmd file located in <code>inst/extdata/tests/subsetCars.Rmd</code> that produces a new object called <code>cars_over_20</code>. The package will be called <code>Test</code>. The work will be done in the system <code>/tmp</code> directory.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(data.tree)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(DataPackageR)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">processing_code =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>,<span class="st">&quot;tests&quot;</span>,<span class="st">&quot;subsetCars.Rmd&quot;</span>,<span class="dt">package=</span><span class="st">&quot;DataPackageR&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">print</span>(processing_code)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">[<span class="dv">1</span>] <span class="st">&quot;/Users/gfinak/Documents/Projects/DataPackageR/inst/extdata/tests/subsetCars.Rmd&quot;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">setwd</span>(<span class="st">&quot;/tmp&quot;</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">DataPackageR<span class="op">::</span><span class="kw">datapackage.skeleton</span>(<span class="st">&quot;Test&quot;</span>, </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">                                   <span class="dt">force=</span><span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">                                   <span class="dt">code_files =</span> processing_code, </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">                                   <span class="dt">r_object_names =</span> <span class="st">&quot;cars_over_20&quot;</span>) <span class="co"># cars_over_20 is an R object </span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">Creating directories ...</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">Creating DESCRIPTION ...</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">Creating NAMESPACE ...</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">Creating Read<span class="op">-</span>and<span class="op">-</span>delete<span class="op">-</span>me ...</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">Saving functions and data ...</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">Making help files ...</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">Done.</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">Further steps are described <span class="cf">in</span> <span class="st">'./Test/Read-and-delete-me'</span>.</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">Adding DataVersion string to DESCRIPTION</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">Creating data and data<span class="op">-</span>raw directories</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">configuring yaml file</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">                                                                    <span class="co"># created in the Rmd file.</span></a></code></pre></div>
<div id="package-skeleton-structure" class="section level3">
<h3>Package skeleton structure</h3>
<p>This has created a directory, “Test” with the skeleton of a data package.</p>
<p>The <code>DESCRIPTION</code> file should be filled out to describe your package. It contains a new <code>DataVersion</code> string, and the revision is automatically incremented if the packaged data changes.</p>
<p><code>Read-and-delete-me</code> has some helpful instructions on how to proceed.</p>
<p>The <code>data-raw</code> directory is where the data cleaning code (<code>Rmd</code>) files reside. The contents of this directory are:</p>
<pre><code>               levelName
1 Test                  
2  ¦--DESCRIPTION       
3  ¦--Read-and-delete-me
4  ¦--data-raw          
5  ¦   °--subsetCars.Rmd
6  °--datapackager.yml  </code></pre>
<p><code>datapackager.yml</code> can be edited as necessary to include additional processing scripts (which should be placed in <code>data-raw</code>), and raw data should be located under under <code>/inst/extdata</code>. It should be copied into that path and the data munging scripts edited to read from there.</p>
</div>
<div id="yaml-configuration" class="section level3">
<h3>Yaml configuration</h3>
<p>Here are the contents of <code>datapackager.yml</code>:</p>
<pre><code>          levelName          files      objects
1 Root                                         
2  °--configuration subsetCars.Rmd cars_over_20</code></pre>
<p>It includes a <code>files</code> property that contains the filenames of the Rmd scripts, and an <code>objects</code> property that lists the data objects produced by the script.</p>
</div>
<div id="build-your-package." class="section level3">
<h3>Build your package.</h3>
<p>Once your scripts are in place and the data objects are documented, you build the package.</p>
<p>To run the build process:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Within the package directory</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">setwd</span>(<span class="st">&quot;/tmp&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">DataPackageR<span class="op">:::</span><span class="kw">buildDataSetPackage</span>(<span class="st">&quot;Test&quot;</span>) </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">Warning <span class="cf">in</span> <span class="kw">normalizePath</span>(raw_data_dir)<span class="op">:</span><span class="st"> </span>path[<span class="dv">1</span>]=<span class="st">&quot;data-raw&quot;</span><span class="op">:</span><span class="st"> </span>No such file or</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">directory</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Logging to <span class="op">/</span>private<span class="op">/</span>tmp<span class="op">/</span>Test<span class="op">/</span>inst<span class="op">/</span>extdata<span class="op">/</span>Logfiles<span class="op">/</span>processing.log</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Processing data</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Read yaml configuration</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Found data<span class="op">-</span>raw<span class="op">/</span>subsetCars.Rmd</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Processing <span class="dv">1</span> of <span class="dv">1</span><span class="op">:</span><span class="st"> </span>data<span class="op">-</span>raw<span class="op">/</span>subsetCars.Rmd</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">processing file<span class="op">:</span><span class="st"> </span>subsetCars.Rmd</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">output file<span class="op">:</span><span class="st"> </span>subsetCars.knit.md</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>bin<span class="op">/</span>pandoc <span class="op">+</span>RTS <span class="op">-</span>K512m <span class="op">-</span>RTS subsetCars.utf8.md <span class="op">--</span>to html4 <span class="op">--</span>from markdown<span class="op">+</span>autolink_bare_uris<span class="op">+</span>ascii_identifiers<span class="op">+</span>tex_math_single_backslash<span class="op">+</span>smart <span class="op">--</span>output <span class="op">/</span>private<span class="op">/</span>tmp<span class="op">/</span>Test<span class="op">/</span>inst<span class="op">/</span>extdata<span class="op">/</span>Logfiles<span class="op">/</span>subsetCars.html <span class="op">--</span>email<span class="op">-</span>obfuscation none <span class="op">--</span>self<span class="op">-</span>contained <span class="op">--</span>standalone <span class="op">--</span>section<span class="op">-</span>divs <span class="op">--</span>template <span class="op">/</span>Library<span class="op">/</span>Frameworks<span class="op">/</span>R.framework<span class="op">/</span>Versions<span class="op">/</span><span class="fl">3.5</span><span class="op">/</span>Resources<span class="op">/</span>library<span class="op">/</span>rmarkdown<span class="op">/</span>rmd<span class="op">/</span>h<span class="op">/</span>default.html <span class="op">--</span>no<span class="op">-</span>highlight <span class="op">--</span>variable highlightjs=<span class="dv">1</span> <span class="op">--</span>variable <span class="st">'theme:bootstrap'</span> <span class="op">--</span>include<span class="op">-</span><span class="cf">in</span><span class="op">-</span>header <span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span><span class="er">/</span>RtmpoPQ54L<span class="op">/</span>rmarkdown<span class="op">-</span>str6c487f70ae8c.html <span class="op">--</span>mathjax <span class="op">--</span>variable <span class="st">'mathjax-url:https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'</span> </a>
<a class="sourceLine" id="cb4-14" data-line-number="14"></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">Output created<span class="op">:</span><span class="st"> </span>inst<span class="op">/</span>extdata<span class="op">/</span>Logfiles<span class="op">/</span>subsetCars.html</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Found <span class="dv">1</span> data objects <span class="cf">in</span> file subsetCars.Rmd</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Saving to data</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">Warning<span class="op">:</span><span class="st"> 'Date'</span> must be an ISO date<span class="op">:</span><span class="st"> </span>yyyy<span class="op">-</span>mm<span class="op">-</span>dd, but it is actually better</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">to leave this field out completely. It is not required.</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Copied documentation to R<span class="op">/</span>Test.R</a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="op">*</span><span class="st"> </span>Creating <span class="st">`</span><span class="dt">vignettes</span><span class="st">`</span>.</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="op">*</span><span class="st"> </span>Adding <span class="st">`</span><span class="dt">inst/doc</span><span class="st">`</span> to .<span class="op">/</span>.gitignore</a>
<a class="sourceLine" id="cb4-23" data-line-number="23">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Removing inst<span class="op">/</span>doc from .gitignore</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Done</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Building documentation</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">First time using roxygen2. Upgrading automatically...</a>
<a class="sourceLine" id="cb4-27" data-line-number="27">Updating roxygen version <span class="cf">in</span> <span class="op">/</span>private<span class="op">/</span>tmp<span class="op">/</span>Test<span class="op">/</span>DESCRIPTION</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">Writing NAMESPACE</a>
<a class="sourceLine" id="cb4-29" data-line-number="29">Writing Test.Rd</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">Writing cars_over_<span class="fl">20.</span>Rd</a>
<a class="sourceLine" id="cb4-31" data-line-number="31">INFO [<span class="dv">2018-05-29</span> <span class="dv">10</span><span class="op">:</span><span class="dv">57</span><span class="op">:</span><span class="dv">37</span>] Building package</a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="st">'/Library/Frameworks/R.framework/Resources/bin/R'</span> <span class="op">--</span>no<span class="op">-</span>site<span class="op">-</span>file  \</a>
<a class="sourceLine" id="cb4-33" data-line-number="33">  <span class="op">--</span>no<span class="op">-</span>environ <span class="op">--</span>no<span class="op">-</span>save <span class="op">--</span>no<span class="op">-</span>restore <span class="op">--</span>quiet CMD build  \</a>
<a class="sourceLine" id="cb4-34" data-line-number="34">  <span class="st">'/private/tmp/Test'</span> <span class="op">--</span>no<span class="op">-</span>resave<span class="op">-</span>data <span class="op">--</span>no<span class="op">-</span>manual <span class="op">--</span>no<span class="op">-</span>build<span class="op">-</span>vignettes </a>
<a class="sourceLine" id="cb4-35" data-line-number="35"></a>
<a class="sourceLine" id="cb4-36" data-line-number="36">[<span class="dv">1</span>] <span class="st">&quot;/private/tmp/Test_1.0.tar.gz&quot;</span></a></code></pre></div>
</div>
<div id="logging-the-build-process" class="section level3">
<h3>Logging the build process</h3>
<p>DataPackageR uses the <code>futile.logger</code> pagckage to log progress. If there are errors in the processing, the script will notify you via logging to console and to <code>/private/tmp/Test/inst/extdata/Logfiles/processing.log</code>. Errors should be corrected and the build repeated.</p>
<p>If everything goes smoothly, you will have a new package built in the parent directory. In this case we have a new package <code>Test_1.0.tar.gz</code>. When the package is installed, it will contain a vignette <code>subsetCars</code> that can be loaded using the <code>vignette()</code> API. The vignette will detail the processing performed by the <code>subsetCars.Rmd</code> processing script.</p>
</div>
<div id="the-package-source-directory-after-building" class="section level3">
<h3>The package source directory after building</h3>
<pre><code>                     levelName</code></pre>
<p>1 Test<br />
2 ¦–DATADIGEST<br />
3 ¦–DESCRIPTION<br />
4 ¦–NAMESPACE<br />
5 ¦–R<br />
6 ¦ °–Test.R<br />
7 ¦–Read-and-delete-me<br />
8 ¦–data-raw<br />
9 ¦ ¦–documentation.R<br />
10 ¦ ¦–subsetCars.R<br />
11 ¦ ¦–subsetCars.Rmd<br />
12 ¦ ¦–subsetCars.knit.md<br />
13 ¦ °–subsetCars.utf8.md<br />
14 ¦–data<br />
15 ¦ °–cars_over_20.rda<br />
16 ¦–datapackager.yml<br />
17 ¦–inst<br />
18 ¦ ¦–doc<br />
19 ¦ ¦ ¦–subsetCars.Rmd<br />
20 ¦ ¦ °–subsetCars.html<br />
21 ¦ °–extdata<br />
22 ¦ °–Logfiles<br />
23 ¦ ¦–processing.log 24 ¦ °–subsetCars.html 25 ¦–man<br />
26 ¦ ¦–Test.Rd<br />
27 ¦ °–cars_over_20.Rd<br />
28 °–vignettes<br />
29 °–subsetCars.Rmd</p>
<div id="details" class="section level4">
<h4>Details</h4>
<p>A number of things have changed. The subsetCars processing script now appears under <code>/vignettes</code> and <code>inst/doc</code> as a processed html report so that it will be available to view via <code>vignette()</code> once the package is installed. <code>inst/extdata/Logfiles</code> contains a log file of the entire build process as well as intermediate files created while parsing the R / Rmd code. Documentation Rd files appear in <code>/man</code>, these should be edite to provide further details on the data objects in the package. The data objects are stored under <code>/data</code> where we see <code>cars_over_20.rda</code>, the object we initially specified in <code>datapackager.yml</code>.</p>
</div>
</div>
</div>
<div id="versioning-data-objects" class="section level2">
<h2>Versioning data objects</h2>
<p>The DataPackageR package calculates an md5 checksum of each data object it stores, and keeps track of them in a file called <code>DATADIGEST</code>.</p>
<ul>
<li>Each time the package is rebuilt, the md5 sums of the new data objects are compared against the DATADIGEST.</li>
<li>If they don’t match, the build process checks that the <code>DataVersion</code> string has been incremented in the <code>DESCRIPTION</code> file.</li>
<li>If it has not the build process will exit and produce an error message.</li>
</ul>
<div id="datadigest" class="section level3">
<h3>DATADIGEST</h3>
<p>The <code>DATADIGEST</code> file contains the following:</p>
<pre><code>DataVersion: 0.1.0
cars_over_20: 3c49acb4246bb42ec9259ae8eb176835</code></pre>
</div>
<div id="description" class="section level3">
<h3>DESCRIPTION</h3>
<p>The description file has the new <code>DataVersion</code> string.</p>
<pre><code>Package: Test
Type: Package
Title: What the package does (short line)
Version: 1.0
Date: Tue May 29 10:57:37 2018
Author: Who wrote it
Maintainer: Who to complain to &lt;yourfault@somewhere.net&gt;
Description: More about what it does (maybe more than one line)
License: What license is it under?
DataVersion: 0.1.0
Suggests: knitr,
    rmarkdown
VignetteBuilder: knitr
RoxygenNote: 6.0.1</code></pre>
</div>
<div id="next-steps" class="section level3">
<h3>Next steps</h3>
<p>Your downstream data analysis can depend on a specific version of your data package (for example by tesing the <code>packageVersion()</code> string);</p>
<pre class="r{}"><code>if(DataPackageR::packageVersion(&quot;MyNewStudy&quot;) != &quot;1.0.0&quot;)
  stop(&quot;The expected version of MyNewStudy is 1.0.0, but &quot;,packageVersion(&quot;MyNewStudy&quot;),&quot; is installed! Analysis results may differ!&quot;)</code></pre>
<p>The DataPackageR packge also provides <code>datasetVersion()</code> to extract the data set version information.</p>
<p>You should also place the data package source directory under <code>git</code> version control. This allows you to version control your data processing code.</p>
</div>
<div id="why-not-use-r-cmd-build" class="section level3">
<h3>Why not use R CMD build?</h3>
<p>If the processing script is time consuming or the data set is particularly large, then <code>R CMD build</code> would run the code each time the package is installed. In such cases, raw data may not be available, or the environment to do the data processing may not be set up for each user of the data. In such cases, DataPackageR provides a mechanism to decouple data processing from package building/installation for downstream users of the data.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
