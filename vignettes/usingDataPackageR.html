<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Greg Finak gfinak@fredhutch.org" />

<meta name="date" content="2018-08-01" />

<title>Using DataPackageR</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Using DataPackageR</h1>
<h4 class="author"><em>Greg Finak <a href="mailto:gfinak@fredhutch.org">gfinak@fredhutch.org</a></em></h4>
<h4 class="date"><em>2018-08-01</em></h4>


<div id="TOC">
<ul>
<li><a href="#purpose">Purpose</a></li>
<li><a href="#set-up-a-new-data-package.">Set up a new data package.</a><ul>
<li><a href="#whats-in-the-package-skeleton-structure">What’s in the package skeleton structure?</a></li>
<li><a href="#a-few-words-abou-the-yaml-config-file">A few words abou the YAML config file</a></li>
<li><a href="#where-do-i-put-my-raw-datasets">Where do I put my raw datasets?</a></li>
<li><a href="#an-api-to-read-raw-data-sets-from-within-an-r-or-rmd-procesing-script.">An API to read raw data sets from within an R or Rmd procesing script.</a></li>
<li><a href="#yaml-header-metadata-for-r-files-and-rmd-files.">YAML header metadata for R files and Rmd files.</a></li>
</ul></li>
<li><a href="#build-the-data-package.">Build the data package.</a><ul>
<li><a href="#documenting-your-data-set-changes-in-news.md">Documenting your data set changes in NEWS.md</a></li>
<li><a href="#why-not-just-use-r-cmd-build">Why not just use R CMD build?</a></li>
<li><a href="#a-log-of-the-build-process">A log of the build process</a></li>
<li><a href="#a-note-about-the-package-source-directory-after-building.">A note about the package source directory after building.</a></li>
<li><a href="#update-the-autogenerated-documentation.">Update the autogenerated documentation.</a></li>
</ul></li>
<li><a href="#installing-and-using-the-new-data-package">Installing and using the new data package</a><ul>
<li><a href="#accessing-vignettes-data-sets-and-data-set-documentation.">Accessing vignettes, data sets, and data set documentation.</a></li>
<li><a href="#using-the-dataversion">Using the DataVersion</a></li>
</ul></li>
<li><a href="#migrating-old-data-packages.">Migrating old data packages.</a><ul>
<li><a href="#create-a-datapackager.yml-file">Create a datapackager.yml file</a></li>
<li><a href="#reading-data-sets-from-rmd-files">Reading data sets from Rmd files</a></li>
</ul></li>
<li><a href="#partial-builds">Partial builds</a></li>
<li><a href="#multi-script-pipelines.">Multi-script pipelines.</a><ul>
<li><a href="#file-system-artifacts">File system artifacts</a></li>
<li><a href="#passing-data-objects-to-subsequent-scripts.">Passing data objects to subsequent scripts.</a></li>
</ul></li>
<li><a href="#next-steps">Next steps</a><ul>
<li><a href="#place-your-package-under-source-control">Place your package under source control</a></li>
</ul></li>
<li><a href="#additional-details">Additional Details</a><ul>
<li><a href="#fingerprints-of-stored-data-objects">Fingerprints of stored data objects</a></li>
</ul></li>
</ul>
</div>

<div id="purpose" class="section level2">
<h2>Purpose</h2>
<p>This vignette demonstrates how to use DataPackageR to build a data package.</p>
<p>DataPackageR aims to simplify data package construction.</p>
<p>It provides mechanisms for reproducibly preprocessing and tidying raw data into into documented, versioned, and packaged analysis-ready data sets.</p>
<p>Long-running or computationally intensive data processing can be decoupled from the usual <code>R CMD build</code> process while maintinaing <a href="https://en.wikipedia.org/wiki/Data_lineage">data lineage</a>.</p>
<p>In this vignette we will subset and package the <code>mtcars</code> data set.</p>
</div>
<div id="set-up-a-new-data-package." class="section level2">
<h2>Set up a new data package.</h2>
<p>We’ll set up a new data package based on <code>mtcars</code> example in the <a href="https://github.com/RGLab/DataPackageR/blob/master/README.md">README</a>. The <code>datapackage_skeleton()</code> API is used to set up a new package. The user needs to provide:</p>
<ul>
<li>R or Rmd code files that do data processing.</li>
<li>A list of R object names created by those code files.</li>
<li>Optionally a path to a directory of raw data (will be copied into the package).</li>
<li>Optionally a list of additional code files that may be dependencies of your R scripts.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(DataPackageR)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># Let's reproducibly package up</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># the cars in the mtcars dataset</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># with speed &gt; 20.</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># Our dataset will be called cars_over_20.</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"># Get the code file that turns the raw data</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co"># to our packaged and processed analysis-ready dataset.</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">processing_code &lt;-</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="st">  </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, </a>
<a class="sourceLine" id="cb1-12" data-line-number="12">              <span class="st">&quot;tests&quot;</span>,</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">              <span class="st">&quot;subsetCars.Rmd&quot;</span>,</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">              <span class="dt">package =</span> <span class="st">&quot;DataPackageR&quot;</span>)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co"># Create the package framework.</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">DataPackageR<span class="op">::</span><span class="kw">datapackage_skeleton</span>(<span class="dt">name =</span> <span class="st">&quot;mtcars20&quot;</span>,</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">  <span class="dt">force =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">  <span class="dt">code_files =</span> processing_code,</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">  <span class="dt">r_object_names =</span> <span class="st">&quot;cars_over_20&quot;</span>,</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">  <span class="dt">path =</span> <span class="kw">tempdir</span>() </a>
<a class="sourceLine" id="cb1-22" data-line-number="22">  <span class="co">#dependencies argument is empty</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23">  <span class="co">#raw_data_dir argument is empty.</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">  ) </a>
<a class="sourceLine" id="cb1-25" data-line-number="25">Adding DataVersion string to DESCRIPTION</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">Creating data and data<span class="op">-</span>raw directories</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">configuring yaml file</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">Moving  code  into data<span class="op">-</span>raw</a></code></pre></div>
<div id="whats-in-the-package-skeleton-structure" class="section level3">
<h3>What’s in the package skeleton structure?</h3>
<p>This has created a datapackage source tree named “mtcars20” (in a temporary directory). For a real use case you would pick a <code>path</code> on your filesystem where you could then initialize a new github repository for the package.</p>
<p>The contents of <code>mtcars20</code> are:</p>
<pre><code>                levelName
1  mtcars20              
2   ¦--data              
3   ¦--data-raw          
4   ¦   °--subsetCars.Rmd
5   ¦--datapackager.yml  
6   ¦--DESCRIPTION       
7   ¦--inst              
8   ¦   °--extdata       
9   ¦--man               
10  ¦--R                 
11  °--Read-and-delete-me</code></pre>
<p>You should fill out the <code>DESCRIPTION</code> file to describe your data package. It contains a new <code>DataVersion</code> string that will be automatically incremented when the data package is built <em>if the packaged data has changed</em>.</p>
<p>The user-provided code files reside in <code>data-raw</code>. They are executed during the data package build process.</p>
</div>
<div id="a-few-words-abou-the-yaml-config-file" class="section level3">
<h3>A few words abou the YAML config file</h3>
<p>A <code>datapackager.yml</code> file is used to configure and control the build process.</p>
<p>The contents are:</p>
<pre><code>configuration:
  files:
    subsetCars.Rmd:
      enabled: yes
  objects: cars_over_20
  render_root:
    tmp: '445902'</code></pre>
<p>The two main pieces of information in the configuration are a list of the files to be processed and the data sets the package will store.</p>
<p>This example packages an R data set named <code>cars_over_20</code> (the name was passed in to <code>datapackage_skeleton()</code>). It is created by the <code>subsetCars.Rmd</code> file.</p>
<p>The objects must be listed in the yaml configuration file. <code>datapackage_skeleton()</code> ensures this is done for you automatically.</p>
<p>DataPackageR provides an API for modifying this file, so it does not need to be done by hand.</p>
<p>Further information on the contents of the YAML configuration file, and the API are in the <a href="YAML_CONFIG.md">YAML Configuration Details</a></p>
</div>
<div id="where-do-i-put-my-raw-datasets" class="section level3">
<h3>Where do I put my raw datasets?</h3>
<p>Raw data (provided the size is not prohibitive) can be placed in <code>inst/extdata</code>.</p>
<p>The <code>datapackage_skeleton()</code> API has the <code>raw_data_dir</code> argument, which will copy the contents of <code>raw_data_dir</code> (and its subdirectories) into <code>inst/extdata</code> automatically.</p>
<p>In this example we are reading the <code>mtcars</code> data set that is already in memory, rather than from the file system.</p>
</div>
<div id="an-api-to-read-raw-data-sets-from-within-an-r-or-rmd-procesing-script." class="section level3">
<h3>An API to read raw data sets from within an R or Rmd procesing script.</h3>
<p>As stated in the README, in order for your processing scripts to be portable, you should not use abosolute paths to files. DataPackageR provides an API to point to the data package root directory and the <code>inst/extdata</code> and <code>data</code> subdirectories. These are useful for constructing portable paths in your code to read files from these locations.</p>
<p>For example: to construct a path to a file named “mydata.csv” located in <code>inst/extdata</code> in your data package source tree:</p>
<ul>
<li>use <code>DataPackageR::project_extdata_path(&quot;mydata.csv&quot;)</code> in your <code>R</code> or <code>Rmd</code> file. This would return: e.g., /var/folders/jh/x0h3v3pd4dd497g3gtzsm8500000gn/T//RtmpHrauiV/mtcars20/inst/extdata/mydata.csv</li>
</ul>
<p>Similarly:</p>
<ul>
<li><code>DataPackageR::project_path()</code> constructs a path to the data package root directory. (e.g., /var/folders/jh/x0h3v3pd4dd497g3gtzsm8500000gn/T//RtmpHrauiV/mtcars20)</li>
<li><code>DataPackageR::project_data_path()</code> constructs a path to the data package <code>data</code> subdirectory. (e.g., /var/folders/jh/x0h3v3pd4dd497g3gtzsm8500000gn/T//RtmpHrauiV/mtcars20/data)</li>
</ul>
<p>Raw data sets that are stored externally (outside the data package source tree) can be constructed relative to the <code>project_path()</code>.</p>
</div>
<div id="yaml-header-metadata-for-r-files-and-rmd-files." class="section level3">
<h3>YAML header metadata for R files and Rmd files.</h3>
<p>If your processing scripts are Rmd files, the usual yaml header for rmarkdown documents should be present.</p>
<p>If you have Rmd files, you can still include a yaml header, but it should be commented with <code>#'</code> and it should be at the top of your R file. For example, a test R file in the DataPackageR package looks as follows:</p>
<pre><code>#'---
#'title: Sample report  from R script
#'author: Greg Finak
#'date: August 1, 2018
#'---
data &lt;- runif(100)</code></pre>
<p>This will be converted to an Rmd file with a proper yaml header, which will then be turned into a vignette and properly indexed in the built package.</p>
</div>
</div>
<div id="build-the-data-package." class="section level2">
<h2>Build the data package.</h2>
<p>Once the skeleton framework is set up,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Run the preprocessing code to build cars_over_20</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co"># and reproducibly enclose it in a package.</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">DataPackageR<span class="op">:::</span><span class="kw">package_build</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(),<span class="st">&quot;mtcars20&quot;</span>))</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">debugging <span class="cf">in</span><span class="op">:</span><span class="st"> </span><span class="kw">DataPackageR</span>(<span class="dt">arg =</span> package_path, <span class="dt">deps =</span> deps)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">debug at <span class="op">/</span>Users<span class="op">/</span>gfinak<span class="op">/</span>Documents<span class="op">/</span>Projects<span class="op">/</span>DataPackageR<span class="op">/</span>R<span class="op">/</span>processData.R<span class="co">#117: {</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    pkg_dir &lt;-<span class="st"> </span>arg</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    pkg_dir &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(pkg_dir, <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    usethis<span class="op">::</span><span class="kw">proj_set</span>(<span class="dt">path =</span> pkg_dir)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    raw_data_dir &lt;-<span class="st"> &quot;data-raw&quot;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    target &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(<span class="kw">file.path</span>(pkg_dir, raw_data_dir), </a>
<a class="sourceLine" id="cb5-11" data-line-number="11">        <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    raw_data_dir &lt;-<span class="st"> </span>target</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">    <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(target)) {</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">        <span class="kw">flog.fatal</span>(<span class="kw">paste0</span>(<span class="st">&quot;Directory &quot;</span>, target, <span class="st">&quot; doesn't exist.&quot;</span>))</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">        {</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">            <span class="kw">stop</span>(<span class="st">&quot;exiting&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">        }</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">    }</a>
<a class="sourceLine" id="cb5-19" data-line-number="19">    <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">        logpath &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(<span class="kw">file.path</span>(pkg_dir, <span class="st">&quot;inst/extdata&quot;</span>), </a>
<a class="sourceLine" id="cb5-21" data-line-number="21">            <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb5-22" data-line-number="22">        logpath &lt;-<span class="st"> </span><span class="kw">file.path</span>(logpath, <span class="st">&quot;Logfiles&quot;</span>)</a>
<a class="sourceLine" id="cb5-23" data-line-number="23">        <span class="kw">dir.create</span>(logpath, <span class="dt">recursive =</span> <span class="ot">TRUE</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">        LOGFILE &lt;-<span class="st"> </span><span class="kw">file.path</span>(logpath, <span class="st">&quot;processing.log&quot;</span>)</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">        <span class="kw">flog.appender</span>(<span class="kw">appender.tee</span>(LOGFILE))</a>
<a class="sourceLine" id="cb5-26" data-line-number="26">        <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Logging to &quot;</span>, LOGFILE))</a>
<a class="sourceLine" id="cb5-27" data-line-number="27">        testme &lt;-<span class="st"> </span><span class="kw">file.path</span>(pkg_dir, <span class="kw">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;inst&quot;</span>, <span class="st">&quot;data&quot;</span>, <span class="st">&quot;data-raw&quot;</span>))</a>
<a class="sourceLine" id="cb5-28" data-line-number="28">        <span class="cf">if</span> (<span class="op">!</span><span class="kw">all</span>(utils<span class="op">::</span><span class="kw">file_test</span>(testme, <span class="dt">op =</span> <span class="st">&quot;-d&quot;</span>))) {</a>
<a class="sourceLine" id="cb5-29" data-line-number="29">            <span class="kw">flog.fatal</span>(<span class="kw">paste0</span>(<span class="st">&quot;You need a valid package data strucutre.&quot;</span>, </a>
<a class="sourceLine" id="cb5-30" data-line-number="30">                <span class="st">&quot; Missing ./R ./inst ./data or&quot;</span>, <span class="st">&quot;./data-raw subdirectories.&quot;</span>))</a>
<a class="sourceLine" id="cb5-31" data-line-number="31">            {</a>
<a class="sourceLine" id="cb5-32" data-line-number="32">                <span class="kw">stop</span>(<span class="st">&quot;exiting&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-33" data-line-number="33">            }</a>
<a class="sourceLine" id="cb5-34" data-line-number="34">        }</a>
<a class="sourceLine" id="cb5-35" data-line-number="35">        <span class="kw">flog.info</span>(<span class="st">&quot;Processing data&quot;</span>)</a>
<a class="sourceLine" id="cb5-36" data-line-number="36">        ymlfile &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="dt">path =</span> pkg_dir, <span class="dt">pattern =</span> <span class="st">&quot;^datapackager.yml$&quot;</span>, </a>
<a class="sourceLine" id="cb5-37" data-line-number="37">            <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-38" data-line-number="38">        <span class="cf">if</span> (<span class="kw">length</span>(ymlfile) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb5-39" data-line-number="39">            <span class="kw">flog.fatal</span>(<span class="kw">paste0</span>(<span class="st">&quot;Yaml configuration file not found at &quot;</span>, </a>
<a class="sourceLine" id="cb5-40" data-line-number="40">                pkg_dir))</a>
<a class="sourceLine" id="cb5-41" data-line-number="41">            {</a>
<a class="sourceLine" id="cb5-42" data-line-number="42">                <span class="kw">stop</span>(<span class="st">&quot;exiting&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-43" data-line-number="43">            }</a>
<a class="sourceLine" id="cb5-44" data-line-number="44">        }</a>
<a class="sourceLine" id="cb5-45" data-line-number="45">        ymlconf &lt;-<span class="st"> </span><span class="kw">read_yaml</span>(ymlfile)</a>
<a class="sourceLine" id="cb5-46" data-line-number="46">        <span class="cf">if</span> (<span class="op">!</span><span class="st">&quot;configuration&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(ymlconf)) {</a>
<a class="sourceLine" id="cb5-47" data-line-number="47">            <span class="kw">flog.fatal</span>(<span class="st">&quot;YAML is missing 'configuration:' entry&quot;</span>)</a>
<a class="sourceLine" id="cb5-48" data-line-number="48">            {</a>
<a class="sourceLine" id="cb5-49" data-line-number="49">                <span class="kw">stop</span>(<span class="st">&quot;exiting&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-50" data-line-number="50">            }</a>
<a class="sourceLine" id="cb5-51" data-line-number="51">        }</a>
<a class="sourceLine" id="cb5-52" data-line-number="52">        <span class="cf">if</span> (<span class="op">!</span><span class="kw">all</span>(<span class="kw">c</span>(<span class="st">&quot;files&quot;</span>, <span class="st">&quot;objects&quot;</span>) <span class="op">%in%</span><span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(ymlconf, </a>
<a class="sourceLine" id="cb5-53" data-line-number="53">            names)[[<span class="st">&quot;configuration&quot;</span>]])) {</a>
<a class="sourceLine" id="cb5-54" data-line-number="54">            <span class="kw">flog.fatal</span>(<span class="st">&quot;YAML is missing files: and objects: entries&quot;</span>)</a>
<a class="sourceLine" id="cb5-55" data-line-number="55">            {</a>
<a class="sourceLine" id="cb5-56" data-line-number="56">                <span class="kw">stop</span>(<span class="st">&quot;exiting&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-57" data-line-number="57">            }</a>
<a class="sourceLine" id="cb5-58" data-line-number="58">        }</a>
<a class="sourceLine" id="cb5-59" data-line-number="59">        <span class="kw">flog.info</span>(<span class="st">&quot;Reading yaml configuration&quot;</span>)</a>
<a class="sourceLine" id="cb5-60" data-line-number="60">        <span class="kw">assert_that</span>(<span class="st">&quot;configuration&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(ymlconf))</a>
<a class="sourceLine" id="cb5-61" data-line-number="61">        <span class="kw">assert_that</span>(<span class="st">&quot;files&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(ymlconf[[<span class="st">&quot;configuration&quot;</span>]]))</a>
<a class="sourceLine" id="cb5-62" data-line-number="62">        <span class="kw">assert_that</span>(<span class="op">!</span><span class="kw">is.null</span>(<span class="kw">names</span>(ymlconf[[<span class="st">&quot;configuration&quot;</span>]][[<span class="st">&quot;files&quot;</span>]])))</a>
<a class="sourceLine" id="cb5-63" data-line-number="63">        r_files &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">names</span>(<span class="kw">Filter</span>(<span class="dt">x =</span> ymlconf[[<span class="st">&quot;configuration&quot;</span>]][[<span class="st">&quot;files&quot;</span>]], </a>
<a class="sourceLine" id="cb5-64" data-line-number="64">            <span class="dt">f =</span> <span class="cf">function</span>(x) x<span class="op">$</span>enabled)))</a>
<a class="sourceLine" id="cb5-65" data-line-number="65">        <span class="cf">if</span> (<span class="kw">length</span>(r_files) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb5-66" data-line-number="66">            <span class="kw">flog.fatal</span>(<span class="st">&quot;No files enabled for processing!&quot;</span>)</a>
<a class="sourceLine" id="cb5-67" data-line-number="67">            {</a>
<a class="sourceLine" id="cb5-68" data-line-number="68">                <span class="kw">stop</span>(<span class="st">&quot;error&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-69" data-line-number="69">            }</a>
<a class="sourceLine" id="cb5-70" data-line-number="70">        }</a>
<a class="sourceLine" id="cb5-71" data-line-number="71">        objects_to_keep &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(ymlconf, <span class="st">&quot;objects&quot;</span>)[[<span class="st">&quot;configuration&quot;</span>]]</a>
<a class="sourceLine" id="cb5-72" data-line-number="72">        render_root &lt;-<span class="st"> </span><span class="kw">.get_render_root</span>(ymlconf)</a>
<a class="sourceLine" id="cb5-73" data-line-number="73">        <span class="cf">if</span> (<span class="op">!</span><span class="kw">.validate_render_root</span>(render_root)) {</a>
<a class="sourceLine" id="cb5-74" data-line-number="74">            <span class="kw">flog.fatal</span>(<span class="kw">paste0</span>(<span class="st">&quot;Can't create, or render_root = &quot;</span>, </a>
<a class="sourceLine" id="cb5-75" data-line-number="75">                render_root, <span class="st">&quot; doesn't exist&quot;</span>))</a>
<a class="sourceLine" id="cb5-76" data-line-number="76">            <span class="kw">stop</span>(<span class="st">&quot;error&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-77" data-line-number="77">        }</a>
<a class="sourceLine" id="cb5-78" data-line-number="78">        <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb5-79" data-line-number="79">            render_root &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(render_root, <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb5-80" data-line-number="80">        }</a>
<a class="sourceLine" id="cb5-81" data-line-number="81">        r_files &lt;-<span class="st"> </span><span class="kw">file.path</span>(raw_data_dir, r_files)</a>
<a class="sourceLine" id="cb5-82" data-line-number="82">        <span class="cf">if</span> (<span class="kw">all</span>(<span class="op">!</span><span class="kw">file.exists</span>(r_files))) {</a>
<a class="sourceLine" id="cb5-83" data-line-number="83">            <span class="kw">flog.fatal</span>(<span class="kw">paste0</span>(<span class="st">&quot;Can't find any R or Rmd files.&quot;</span>))</a>
<a class="sourceLine" id="cb5-84" data-line-number="84">            <span class="kw">flog.fatal</span>(<span class="kw">paste0</span>(<span class="st">&quot;     Cant' find file: &quot;</span>, r_files[<span class="op">!</span><span class="kw">file.exists</span>(r_files)]))</a>
<a class="sourceLine" id="cb5-85" data-line-number="85">            <span class="kw">stop</span>(<span class="st">&quot;error&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-86" data-line-number="86">        }</a>
<a class="sourceLine" id="cb5-87" data-line-number="87">        <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Found &quot;</span>, r_files))</a>
<a class="sourceLine" id="cb5-88" data-line-number="88">        old_data_digest &lt;-<span class="st"> </span><span class="kw">.parse_data_digest</span>(<span class="dt">pkg_dir =</span> pkg_dir)</a>
<a class="sourceLine" id="cb5-89" data-line-number="89">        description_file &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(<span class="kw">file.path</span>(pkg_dir, </a>
<a class="sourceLine" id="cb5-90" data-line-number="90">            <span class="st">&quot;DESCRIPTION&quot;</span>), <span class="dt">winslash =</span> <span class="st">&quot;/&quot;</span>)</a>
<a class="sourceLine" id="cb5-91" data-line-number="91">        pkg_description &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">read.description</span>(<span class="dt">file =</span> description_file), </a>
<a class="sourceLine" id="cb5-92" data-line-number="92">            <span class="dt">silent =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-93" data-line-number="93">        <span class="cf">if</span> (<span class="kw">length</span>(objects_to_keep) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb5-94" data-line-number="94">            <span class="kw">flog.fatal</span>(<span class="st">&quot;You must specify at least one data object.&quot;</span>)</a>
<a class="sourceLine" id="cb5-95" data-line-number="95">            {</a>
<a class="sourceLine" id="cb5-96" data-line-number="96">                <span class="kw">stop</span>(<span class="st">&quot;exiting&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-97" data-line-number="97">            }</a>
<a class="sourceLine" id="cb5-98" data-line-number="98">        }</a>
<a class="sourceLine" id="cb5-99" data-line-number="99">        do_documentation &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-100" data-line-number="100">        can_write &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-101" data-line-number="101">        ENVS &lt;-<span class="st"> </span><span class="kw">new.env</span>(<span class="dt">hash =</span> <span class="ot">TRUE</span>, <span class="dt">parent =</span> .GlobalEnv)</a>
<a class="sourceLine" id="cb5-102" data-line-number="102">        <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(r_files)) {</a>
<a class="sourceLine" id="cb5-103" data-line-number="103">            dataenv &lt;-<span class="st"> </span><span class="kw">new.env</span>(<span class="dt">hash =</span> <span class="ot">TRUE</span>, <span class="dt">parent =</span> .GlobalEnv)</a>
<a class="sourceLine" id="cb5-104" data-line-number="104">            <span class="cf">if</span> (deps) </a>
<a class="sourceLine" id="cb5-105" data-line-number="105">                <span class="kw">assign</span>(<span class="dt">x =</span> <span class="st">&quot;ENVS&quot;</span>, <span class="dt">value =</span> ENVS, dataenv)</a>
<a class="sourceLine" id="cb5-106" data-line-number="106">            <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Processing &quot;</span>, i, <span class="st">&quot; of &quot;</span>, <span class="kw">length</span>(r_files), </a>
<a class="sourceLine" id="cb5-107" data-line-number="107">                <span class="st">&quot;: &quot;</span>, r_files[i], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb5-108" data-line-number="108">            flag &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-109" data-line-number="109">            .isRfile &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</a>
<a class="sourceLine" id="cb5-110" data-line-number="110">                <span class="kw">grepl</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">.r$&quot;</span>, <span class="kw">tolower</span>(f))</a>
<a class="sourceLine" id="cb5-111" data-line-number="111">            }</a>
<a class="sourceLine" id="cb5-112" data-line-number="112">            <span class="cf">if</span> (flag &lt;-<span class="st"> </span><span class="kw">.isRfile</span>(r_files[i])) {</a>
<a class="sourceLine" id="cb5-113" data-line-number="113">                knitr<span class="op">::</span><span class="kw">spin</span>(r_files[i], <span class="dt">precious =</span> <span class="ot">TRUE</span>, <span class="dt">knit =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-114" data-line-number="114">                r_files[i] &lt;-<span class="st"> </span><span class="kw">paste0</span>(tools<span class="op">::</span><span class="kw">file_path_sans_ext</span>(r_files[i]), </a>
<a class="sourceLine" id="cb5-115" data-line-number="115">                  <span class="st">&quot;.Rmd&quot;</span>)</a>
<a class="sourceLine" id="cb5-116" data-line-number="116">                <span class="kw">assert_that</span>(<span class="kw">file.exists</span>(r_files[i]), <span class="dt">msg =</span> <span class="kw">paste0</span>(<span class="st">&quot;File: &quot;</span>, </a>
<a class="sourceLine" id="cb5-117" data-line-number="117">                  r_files[i], <span class="st">&quot; does not exist!&quot;</span>))</a>
<a class="sourceLine" id="cb5-118" data-line-number="118">                lines &lt;-<span class="st"> </span><span class="kw">readLines</span>(r_files[i])</a>
<a class="sourceLine" id="cb5-119" data-line-number="119">                lines &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;---&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;title: &quot;</span>, <span class="kw">basename</span>(r_files[i])), </a>
<a class="sourceLine" id="cb5-120" data-line-number="120">                  <span class="kw">paste0</span>(<span class="st">&quot;author: &quot;</span>, <span class="kw">Sys.info</span>()[<span class="st">&quot;user&quot;</span>]), <span class="kw">paste0</span>(<span class="st">&quot;date: &quot;</span>, </a>
<a class="sourceLine" id="cb5-121" data-line-number="121">                    <span class="kw">Sys.Date</span>()), <span class="st">&quot;---&quot;</span>, <span class="st">&quot;&quot;</span>, lines)</a>
<a class="sourceLine" id="cb5-122" data-line-number="122">                con &lt;-<span class="st"> </span><span class="kw">file</span>(r_files[i])</a>
<a class="sourceLine" id="cb5-123" data-line-number="123">                <span class="kw">writeLines</span>(lines, <span class="dt">con =</span> con, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb5-124" data-line-number="124">                <span class="kw">close</span>(con)</a>
<a class="sourceLine" id="cb5-125" data-line-number="125">            }</a>
<a class="sourceLine" id="cb5-126" data-line-number="126">            rmarkdown<span class="op">::</span><span class="kw">render</span>(<span class="dt">input =</span> r_files[i], <span class="dt">envir =</span> dataenv, </a>
<a class="sourceLine" id="cb5-127" data-line-number="127">                <span class="dt">output_dir =</span> logpath, <span class="dt">clean =</span> <span class="ot">TRUE</span>, <span class="dt">knit_root_dir =</span> render_root)</a>
<a class="sourceLine" id="cb5-128" data-line-number="128">            object_names &lt;-<span class="st"> </span><span class="kw">ls</span>(dataenv)</a>
<a class="sourceLine" id="cb5-129" data-line-number="129">            <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="kw">sum</span>(objects_to_keep <span class="op">%in%</span><span class="st"> </span>object_names), </a>
<a class="sourceLine" id="cb5-130" data-line-number="130">                <span class="st">&quot; required data objects created by &quot;</span>, <span class="kw">basename</span>(r_files[i])))</a>
<a class="sourceLine" id="cb5-131" data-line-number="131">            <span class="cf">if</span> (<span class="kw">sum</span>(objects_to_keep <span class="op">%in%</span><span class="st"> </span>object_names) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb5-132" data-line-number="132">                <span class="cf">for</span> (o <span class="cf">in</span> objects_to_keep[objects_to_keep <span class="op">%in%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-133" data-line-number="133"><span class="st">                  </span>object_names]) {</a>
<a class="sourceLine" id="cb5-134" data-line-number="134">                  <span class="kw">assign</span>(o, <span class="kw">get</span>(o, dataenv), ENVS)</a>
<a class="sourceLine" id="cb5-135" data-line-number="135">                }</a>
<a class="sourceLine" id="cb5-136" data-line-number="136">            }</a>
<a class="sourceLine" id="cb5-137" data-line-number="137">        }</a>
<a class="sourceLine" id="cb5-138" data-line-number="138">        dataenv &lt;-<span class="st"> </span>ENVS</a>
<a class="sourceLine" id="cb5-139" data-line-number="139">        new_data_digest &lt;-<span class="st"> </span><span class="kw">.digest_data_env</span>(<span class="kw">ls</span>(ENVS), dataenv, </a>
<a class="sourceLine" id="cb5-140" data-line-number="140">            pkg_description)</a>
<a class="sourceLine" id="cb5-141" data-line-number="141">        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(old_data_digest)) {</a>
<a class="sourceLine" id="cb5-142" data-line-number="142">            string_check &lt;-<span class="st"> </span><span class="kw">.check_dataversion_string</span>(old_data_digest, </a>
<a class="sourceLine" id="cb5-143" data-line-number="143">                new_data_digest)</a>
<a class="sourceLine" id="cb5-144" data-line-number="144">            can_write &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-145" data-line-number="145">            <span class="kw">stopifnot</span>(<span class="op">!</span>((<span class="op">!</span><span class="kw">.compare_digests</span>(old_data_digest, new_data_digest)) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-146" data-line-number="146"><span class="st">                </span>string_check<span class="op">$</span>isgreater))</a>
<a class="sourceLine" id="cb5-147" data-line-number="147">            <span class="cf">if</span> (<span class="kw">.compare_digests</span>(old_data_digest, new_data_digest) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-148" data-line-number="148"><span class="st">                </span>string_check<span class="op">$</span>isequal) {</a>
<a class="sourceLine" id="cb5-149" data-line-number="149">                can_write &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-150" data-line-number="150">                <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Processed data sets match &quot;</span>, </a>
<a class="sourceLine" id="cb5-151" data-line-number="151">                  <span class="st">&quot;existing data sets at version &quot;</span>, new_data_digest[[<span class="st">&quot;DataVersion&quot;</span>]]))</a>
<a class="sourceLine" id="cb5-152" data-line-number="152">            }</a>
<a class="sourceLine" id="cb5-153" data-line-number="153">            <span class="cf">else</span> <span class="cf">if</span> ((<span class="op">!</span><span class="kw">.compare_digests</span>(old_data_digest, new_data_digest)) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-154" data-line-number="154"><span class="st">                </span>string_check<span class="op">$</span>isequal) {</a>
<a class="sourceLine" id="cb5-155" data-line-number="155">                updated_version &lt;-<span class="st"> </span><span class="kw">.increment_data_version</span>(pkg_description, </a>
<a class="sourceLine" id="cb5-156" data-line-number="156">                  new_data_digest)</a>
<a class="sourceLine" id="cb5-157" data-line-number="157">                <span class="kw">.update_news_md</span>(updated_version<span class="op">$</span>new_data_digest[[<span class="st">&quot;DataVersion&quot;</span>]])</a>
<a class="sourceLine" id="cb5-158" data-line-number="158">                pkg_description &lt;-<span class="st"> </span>updated_version<span class="op">$</span>pkg_description</a>
<a class="sourceLine" id="cb5-159" data-line-number="159">                new_data_digest &lt;-<span class="st"> </span>updated_version<span class="op">$</span>new_data_digest</a>
<a class="sourceLine" id="cb5-160" data-line-number="160">                can_write &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-161" data-line-number="161">                <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Data has been updated and DataVersion &quot;</span>, </a>
<a class="sourceLine" id="cb5-162" data-line-number="162">                  <span class="st">&quot;string incremented automatically to &quot;</span>, new_data_digest[[<span class="st">&quot;DataVersion&quot;</span>]]))</a>
<a class="sourceLine" id="cb5-163" data-line-number="163">            }</a>
<a class="sourceLine" id="cb5-164" data-line-number="164">            <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">.compare_digests</span>(old_data_digest, new_data_digest) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-165" data-line-number="165"><span class="st">                </span>string_check<span class="op">$</span>isgreater) {</a>
<a class="sourceLine" id="cb5-166" data-line-number="166">                can_write &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-167" data-line-number="167">                <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Data hasn't changed but the &quot;</span>, </a>
<a class="sourceLine" id="cb5-168" data-line-number="168">                  <span class="st">&quot;DataVersion has been bumped.&quot;</span>))</a>
<a class="sourceLine" id="cb5-169" data-line-number="169">            }</a>
<a class="sourceLine" id="cb5-170" data-line-number="170">            <span class="cf">else</span> <span class="cf">if</span> (string_check<span class="op">$</span>isless <span class="op">&amp;</span><span class="st"> </span><span class="kw">.compare_digests</span>(old_data_digest, </a>
<a class="sourceLine" id="cb5-171" data-line-number="171">                new_data_digest)) {</a>
<a class="sourceLine" id="cb5-172" data-line-number="172">                <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;New DataVersion is less than &quot;</span>, </a>
<a class="sourceLine" id="cb5-173" data-line-number="173">                  <span class="st">&quot;old but data are unchanged&quot;</span>))</a>
<a class="sourceLine" id="cb5-174" data-line-number="174">                new_data_digest &lt;-<span class="st"> </span>old_data_digest</a>
<a class="sourceLine" id="cb5-175" data-line-number="175">                pkg_description[[<span class="st">&quot;DataVersion&quot;</span>]] &lt;-<span class="st"> </span>new_data_digest[[<span class="st">&quot;DataVersion&quot;</span>]]</a>
<a class="sourceLine" id="cb5-176" data-line-number="176">                can_write &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-177" data-line-number="177">            }</a>
<a class="sourceLine" id="cb5-178" data-line-number="178">            <span class="cf">else</span> <span class="cf">if</span> (string_check<span class="op">$</span>isless <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">.compare_digests</span>(old_data_digest, </a>
<a class="sourceLine" id="cb5-179" data-line-number="179">                new_data_digest)) {</a>
<a class="sourceLine" id="cb5-180" data-line-number="180">                updated_version &lt;-<span class="st"> </span><span class="kw">.increment_data_version</span>(pkg_description, </a>
<a class="sourceLine" id="cb5-181" data-line-number="181">                  new_data_digest)</a>
<a class="sourceLine" id="cb5-182" data-line-number="182">                <span class="kw">.update_news_md</span>(updated_version<span class="op">$</span>new_data_digest[[<span class="st">&quot;DataVersion&quot;</span>]])</a>
<a class="sourceLine" id="cb5-183" data-line-number="183">                pkg_description &lt;-<span class="st"> </span>updated_version<span class="op">$</span>pkg_description</a>
<a class="sourceLine" id="cb5-184" data-line-number="184">                new_data_digest &lt;-<span class="st"> </span>updated_version<span class="op">$</span>new_data_digest</a>
<a class="sourceLine" id="cb5-185" data-line-number="185">                can_write &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-186" data-line-number="186">            }</a>
<a class="sourceLine" id="cb5-187" data-line-number="187">            <span class="cf">if</span> (can_write) {</a>
<a class="sourceLine" id="cb5-188" data-line-number="188">                <span class="kw">.save_data</span>(new_data_digest, pkg_description, </a>
<a class="sourceLine" id="cb5-189" data-line-number="189">                  <span class="kw">ls</span>(dataenv), dataenv, <span class="dt">old_data_digest =</span> old_data_digest, </a>
<a class="sourceLine" id="cb5-190" data-line-number="190">                  <span class="dt">pkg_path =</span> pkg_dir)</a>
<a class="sourceLine" id="cb5-191" data-line-number="191">                do_documentation &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-192" data-line-number="192">            }</a>
<a class="sourceLine" id="cb5-193" data-line-number="193">        }</a>
<a class="sourceLine" id="cb5-194" data-line-number="194">        <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb5-195" data-line-number="195">            <span class="kw">.update_news_md</span>(new_data_digest[[<span class="st">&quot;DataVersion&quot;</span>]])</a>
<a class="sourceLine" id="cb5-196" data-line-number="196">            <span class="kw">.save_data</span>(new_data_digest, pkg_description, <span class="kw">ls</span>(dataenv), </a>
<a class="sourceLine" id="cb5-197" data-line-number="197">                dataenv, <span class="dt">old_data_digest =</span> <span class="ot">NULL</span>, <span class="dt">pkg_path =</span> pkg_dir)</a>
<a class="sourceLine" id="cb5-198" data-line-number="198">            do_documentation &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-199" data-line-number="199">        }</a>
<a class="sourceLine" id="cb5-200" data-line-number="200">        <span class="cf">if</span> (do_documentation) {</a>
<a class="sourceLine" id="cb5-201" data-line-number="201">            <span class="cf">if</span> (<span class="op">!</span><span class="kw">file.exists</span>(<span class="kw">file.path</span>(target, <span class="st">&quot;documentation.R&quot;</span>))) {</a>
<a class="sourceLine" id="cb5-202" data-line-number="202">                <span class="kw">.doc_autogen</span>(<span class="kw">basename</span>(pkg_dir), <span class="dt">ds2kp =</span> <span class="kw">ls</span>(dataenv), </a>
<a class="sourceLine" id="cb5-203" data-line-number="203">                  <span class="dt">env =</span> dataenv, <span class="dt">path =</span> target)</a>
<a class="sourceLine" id="cb5-204" data-line-number="204">            }</a>
<a class="sourceLine" id="cb5-205" data-line-number="205">            doc_parsed &lt;-<span class="st"> </span><span class="kw">.doc_parse</span>(<span class="kw">file.path</span>(target, <span class="st">&quot;documentation.R&quot;</span>))</a>
<a class="sourceLine" id="cb5-206" data-line-number="206">            .identify_missing_docs &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">environment =</span> <span class="ot">NULL</span>, </a>
<a class="sourceLine" id="cb5-207" data-line-number="207">                <span class="dt">description =</span> <span class="ot">NULL</span>, <span class="dt">docs =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb5-208" data-line-number="208">                <span class="kw">setdiff</span>(<span class="kw">ls</span>(environment), <span class="kw">setdiff</span>(<span class="kw">names</span>(docs), </a>
<a class="sourceLine" id="cb5-209" data-line-number="209">                  description[[<span class="st">&quot;Package&quot;</span>]]))</a>
<a class="sourceLine" id="cb5-210" data-line-number="210">            }</a>
<a class="sourceLine" id="cb5-211" data-line-number="211">            missing_doc_for_autodoc &lt;-<span class="st"> </span><span class="kw">.identify_missing_docs</span>(dataenv, </a>
<a class="sourceLine" id="cb5-212" data-line-number="212">                pkg_description, doc_parsed)</a>
<a class="sourceLine" id="cb5-213" data-line-number="213">            <span class="cf">if</span> (<span class="kw">length</span>(missing_doc_for_autodoc) <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb5-214" data-line-number="214">                tmptarget &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb5-215" data-line-number="215">                <span class="kw">file.info</span>(<span class="st">&quot;Writing missing docs.&quot;</span>)</a>
<a class="sourceLine" id="cb5-216" data-line-number="216">                <span class="kw">.doc_autogen</span>(<span class="kw">basename</span>(pkg_dir), <span class="dt">ds2kp =</span> missing_doc_for_autodoc, </a>
<a class="sourceLine" id="cb5-217" data-line-number="217">                  <span class="dt">env =</span> dataenv, <span class="dt">path =</span> tmptarget, <span class="dt">name =</span> <span class="st">&quot;missing_doc.R&quot;</span>)</a>
<a class="sourceLine" id="cb5-218" data-line-number="218">                missing_doc &lt;-<span class="st"> </span><span class="kw">.doc_parse</span>(<span class="kw">file.path</span>(tmptarget, </a>
<a class="sourceLine" id="cb5-219" data-line-number="219">                  <span class="st">&quot;missing_doc.R&quot;</span>))</a>
<a class="sourceLine" id="cb5-220" data-line-number="220">                doc_parsed &lt;-<span class="st"> </span><span class="kw">.doc_merge</span>(<span class="dt">old =</span> doc_parsed, <span class="dt">new =</span> missing_doc)</a>
<a class="sourceLine" id="cb5-221" data-line-number="221">                <span class="kw">file.info</span>(<span class="st">&quot;Writing merged docs.&quot;</span>)</a>
<a class="sourceLine" id="cb5-222" data-line-number="222">                docfile &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="kw">file.path</span>(target, <span class="kw">paste0</span>(<span class="st">&quot;documentation&quot;</span>, </a>
<a class="sourceLine" id="cb5-223" data-line-number="223">                  <span class="st">&quot;.R&quot;</span>)), <span class="dt">open =</span> <span class="st">&quot;w&quot;</span>)</a>
<a class="sourceLine" id="cb5-224" data-line-number="224">                <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(doc_parsed)) {</a>
<a class="sourceLine" id="cb5-225" data-line-number="225">                  <span class="kw">writeLines</span>(<span class="dt">text =</span> doc_parsed[[i]], <span class="dt">con =</span> docfile)</a>
<a class="sourceLine" id="cb5-226" data-line-number="226">                }</a>
<a class="sourceLine" id="cb5-227" data-line-number="227">            }</a>
<a class="sourceLine" id="cb5-228" data-line-number="228">            save_docs &lt;-<span class="st"> </span><span class="kw">do.call</span>(c, doc_parsed)</a>
<a class="sourceLine" id="cb5-229" data-line-number="229">            docfile &lt;-<span class="st"> </span><span class="kw">file</span>(<span class="kw">file.path</span>(pkg_dir, <span class="st">&quot;R&quot;</span>, <span class="dt">pattern =</span> <span class="kw">paste0</span>(pkg_description<span class="op">$</span>Package, </a>
<a class="sourceLine" id="cb5-230" data-line-number="230">                <span class="st">&quot;.R&quot;</span>)), <span class="dt">open =</span> <span class="st">&quot;w&quot;</span>)</a>
<a class="sourceLine" id="cb5-231" data-line-number="231">            <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(save_docs)) {</a>
<a class="sourceLine" id="cb5-232" data-line-number="232">                <span class="kw">writeLines</span>(<span class="dt">text =</span> save_docs[[i]], <span class="dt">con =</span> docfile)</a>
<a class="sourceLine" id="cb5-233" data-line-number="233">            }</a>
<a class="sourceLine" id="cb5-234" data-line-number="234">            <span class="kw">close</span>(docfile)</a>
<a class="sourceLine" id="cb5-235" data-line-number="235">            <span class="kw">flog.info</span>(<span class="kw">paste0</span>(<span class="st">&quot;Copied documentation to &quot;</span>, <span class="kw">file.path</span>(pkg_dir, </a>
<a class="sourceLine" id="cb5-236" data-line-number="236">                <span class="st">&quot;R&quot;</span>, <span class="kw">paste0</span>(pkg_description<span class="op">$</span>Package, <span class="st">&quot;.R&quot;</span>))))</a>
<a class="sourceLine" id="cb5-237" data-line-number="237">            can_write &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-238" data-line-number="238">        }</a>
<a class="sourceLine" id="cb5-239" data-line-number="239">        <span class="kw">eval</span>(<span class="dt">expr =</span> <span class="kw">expression</span>(<span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())), <span class="dt">envir =</span> dataenv)</a>
<a class="sourceLine" id="cb5-240" data-line-number="240">        <span class="kw">.ppfiles_mkvignettes</span>(<span class="dt">dir =</span> pkg_dir)</a>
<a class="sourceLine" id="cb5-241" data-line-number="241">    }</a>
<a class="sourceLine" id="cb5-242" data-line-number="242">    <span class="kw">flog.info</span>(<span class="st">&quot;Done&quot;</span>)</a>
<a class="sourceLine" id="cb5-243" data-line-number="243">    <span class="kw">return</span>(can_write)</a>
<a class="sourceLine" id="cb5-244" data-line-number="244"><span class="er">}</span></a>
<a class="sourceLine" id="cb5-245" data-line-number="245">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">51</span>] Logging to <span class="op">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>inst<span class="op">/</span>extdata<span class="op">/</span>Logfiles<span class="op">/</span>processing.log</a>
<a class="sourceLine" id="cb5-246" data-line-number="246">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">51</span>] Processing data</a>
<a class="sourceLine" id="cb5-247" data-line-number="247">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">51</span>] Reading yaml configuration</a>
<a class="sourceLine" id="cb5-248" data-line-number="248">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">51</span>] Found <span class="op">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>data<span class="op">-</span>raw<span class="op">/</span>subsetCars.Rmd</a>
<a class="sourceLine" id="cb5-249" data-line-number="249">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">51</span>] Processing <span class="dv">1</span> of <span class="dv">1</span><span class="op">:</span><span class="st"> </span><span class="er">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>data<span class="op">-</span>raw<span class="op">/</span>subsetCars.Rmd</a>
<a class="sourceLine" id="cb5-250" data-line-number="250"></a>
<a class="sourceLine" id="cb5-251" data-line-number="251"></a>
<a class="sourceLine" id="cb5-252" data-line-number="252">processing file<span class="op">:</span><span class="st"> </span>subsetCars.Rmd</a>
<a class="sourceLine" id="cb5-253" data-line-number="253"></a>
<a class="sourceLine" id="cb5-254" data-line-number="254">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-255" data-line-number="255"><span class="st">  </span><span class="er">|</span><span class="st">                                                                 </span><span class="er">|</span><span class="st">   </span><span class="dv">0</span>%</a>
<a class="sourceLine" id="cb5-256" data-line-number="256">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-257" data-line-number="257"><span class="st">  </span><span class="er">|</span>.........                                                        <span class="op">|</span><span class="st">  </span><span class="dv">14</span>%</a>
<a class="sourceLine" id="cb5-258" data-line-number="258">  ordinary text without R code</a>
<a class="sourceLine" id="cb5-259" data-line-number="259"></a>
<a class="sourceLine" id="cb5-260" data-line-number="260"></a>
<a class="sourceLine" id="cb5-261" data-line-number="261">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-262" data-line-number="262"><span class="st">  </span><span class="er">|</span>...................                                              <span class="op">|</span><span class="st">  </span><span class="dv">29</span>%</a>
<a class="sourceLine" id="cb5-263" data-line-number="263">label<span class="op">:</span><span class="st"> </span>unnamed<span class="op">-</span>chunk<span class="dv">-11</span> (with options) </a>
<a class="sourceLine" id="cb5-264" data-line-number="264">List of <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-265" data-line-number="265"> <span class="op">$</span><span class="st"> </span>include<span class="op">:</span><span class="st"> </span>logi <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb5-266" data-line-number="266"></a>
<a class="sourceLine" id="cb5-267" data-line-number="267"></a>
<a class="sourceLine" id="cb5-268" data-line-number="268">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-269" data-line-number="269"><span class="st">  </span><span class="er">|</span>............................                                     <span class="op">|</span><span class="st">  </span><span class="dv">43</span>%</a>
<a class="sourceLine" id="cb5-270" data-line-number="270">  ordinary text without R code</a>
<a class="sourceLine" id="cb5-271" data-line-number="271"></a>
<a class="sourceLine" id="cb5-272" data-line-number="272"></a>
<a class="sourceLine" id="cb5-273" data-line-number="273">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-274" data-line-number="274"><span class="st">  </span><span class="er">|</span>.....................................                            <span class="op">|</span><span class="st">  </span><span class="dv">57</span>%</a>
<a class="sourceLine" id="cb5-275" data-line-number="275">label<span class="op">:</span><span class="st"> </span>cars</a>
<a class="sourceLine" id="cb5-276" data-line-number="276"></a>
<a class="sourceLine" id="cb5-277" data-line-number="277">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-278" data-line-number="278"><span class="st">  </span><span class="er">|</span>..............................................                   <span class="op">|</span><span class="st">  </span><span class="dv">71</span>%</a>
<a class="sourceLine" id="cb5-279" data-line-number="279">  ordinary text without R code</a>
<a class="sourceLine" id="cb5-280" data-line-number="280"></a>
<a class="sourceLine" id="cb5-281" data-line-number="281"></a>
<a class="sourceLine" id="cb5-282" data-line-number="282">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-283" data-line-number="283"><span class="st">  </span><span class="er">|</span>........................................................         <span class="op">|</span><span class="st">  </span><span class="dv">86</span>%</a>
<a class="sourceLine" id="cb5-284" data-line-number="284">label<span class="op">:</span><span class="st"> </span>unnamed<span class="op">-</span>chunk<span class="dv">-12</span></a>
<a class="sourceLine" id="cb5-285" data-line-number="285"></a>
<a class="sourceLine" id="cb5-286" data-line-number="286">  <span class="op">|</span><span class="st">                                                                       </span></a>
<a class="sourceLine" id="cb5-287" data-line-number="287"><span class="st">  </span><span class="er">|</span>.................................................................<span class="op">|</span><span class="st"> </span><span class="dv">100</span>%</a>
<a class="sourceLine" id="cb5-288" data-line-number="288">  ordinary text without R code</a>
<a class="sourceLine" id="cb5-289" data-line-number="289">output file<span class="op">:</span><span class="st"> </span>subsetCars.knit.md</a>
<a class="sourceLine" id="cb5-290" data-line-number="290"><span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>bin<span class="op">/</span>pandoc <span class="op">+</span>RTS <span class="op">-</span>K512m <span class="op">-</span>RTS subsetCars.utf8.md <span class="op">--</span>to html4 <span class="op">--</span>from markdown<span class="op">+</span>autolink_bare_uris<span class="op">+</span>ascii_identifiers<span class="op">+</span>tex_math_single_backslash<span class="op">+</span>smart <span class="op">--</span>output <span class="op">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>inst<span class="op">/</span>extdata<span class="op">/</span>Logfiles<span class="op">/</span>subsetCars.html <span class="op">--</span>email<span class="op">-</span>obfuscation none <span class="op">--</span>self<span class="op">-</span>contained <span class="op">--</span>standalone <span class="op">--</span>section<span class="op">-</span>divs <span class="op">--</span>template <span class="op">/</span>Library<span class="op">/</span>Frameworks<span class="op">/</span>R.framework<span class="op">/</span>Versions<span class="op">/</span><span class="fl">3.5</span><span class="op">/</span>Resources<span class="op">/</span>library<span class="op">/</span>rmarkdown<span class="op">/</span>rmd<span class="op">/</span>h<span class="op">/</span>default.html <span class="op">--</span>no<span class="op">-</span>highlight <span class="op">--</span>variable highlightjs=<span class="dv">1</span> <span class="op">--</span>variable <span class="st">'theme:bootstrap'</span> <span class="op">--</span>include<span class="op">-</span><span class="cf">in</span><span class="op">-</span>header <span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span><span class="er">/</span>RtmpHrauiV<span class="op">/</span>rmarkdown<span class="op">-</span>str14e3f42f0272c.html <span class="op">--</span>mathjax <span class="op">--</span>variable <span class="st">'mathjax-url:https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'</span> </a>
<a class="sourceLine" id="cb5-291" data-line-number="291"></a>
<a class="sourceLine" id="cb5-292" data-line-number="292">Output created<span class="op">:</span><span class="st"> </span><span class="er">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>inst<span class="op">/</span>extdata<span class="op">/</span>Logfiles<span class="op">/</span>subsetCars.html</a>
<a class="sourceLine" id="cb5-293" data-line-number="293">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">52</span>] <span class="dv">1</span> required data objects created by subsetCars.Rmd</a>
<a class="sourceLine" id="cb5-294" data-line-number="294">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">52</span>] NEWS.md file not found, creating<span class="op">!</span></a>
<a class="sourceLine" id="cb5-295" data-line-number="295">Enter a text description of the changes <span class="cf">for</span> the NEWS file.</a>
<a class="sourceLine" id="cb5-296" data-line-number="296">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">57</span>] Saving to data</a>
<a class="sourceLine" id="cb5-297" data-line-number="297">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">57</span>] Copied documentation to <span class="op">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>R<span class="op">/</span>mtcars20.R</a>
<a class="sourceLine" id="cb5-298" data-line-number="298"></a>
<a class="sourceLine" id="cb5-299" data-line-number="299">✔ Creating <span class="st">'vignettes/'</span></a>
<a class="sourceLine" id="cb5-300" data-line-number="300">✔ Creating <span class="st">'inst/doc/'</span></a>
<a class="sourceLine" id="cb5-301" data-line-number="301">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">57</span>] Done</a>
<a class="sourceLine" id="cb5-302" data-line-number="302">exiting from<span class="op">:</span><span class="st"> </span><span class="kw">DataPackageR</span>(<span class="dt">arg =</span> package_path, <span class="dt">deps =</span> deps)</a>
<a class="sourceLine" id="cb5-303" data-line-number="303">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">57</span>] DataPackageR succeeded</a>
<a class="sourceLine" id="cb5-304" data-line-number="304">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">57</span>] Building documentation</a>
<a class="sourceLine" id="cb5-305" data-line-number="305">First time using roxygen2. Upgrading automatically...</a>
<a class="sourceLine" id="cb5-306" data-line-number="306">Updating roxygen version <span class="cf">in</span> <span class="op">/</span>private<span class="op">/</span>var<span class="op">/</span>folders<span class="op">/</span>jh<span class="op">/</span>x0h3v3pd4dd497g3gtzsm8500000gn<span class="op">/</span>T<span class="op">/</span>RtmpHrauiV<span class="op">/</span>mtcars20<span class="op">/</span>DESCRIPTION</a>
<a class="sourceLine" id="cb5-307" data-line-number="307">Writing NAMESPACE</a>
<a class="sourceLine" id="cb5-308" data-line-number="308">Loading mtcars20</a>
<a class="sourceLine" id="cb5-309" data-line-number="309">Writing mtcars20.Rd</a>
<a class="sourceLine" id="cb5-310" data-line-number="310">Writing cars_over_<span class="fl">20.</span>Rd</a>
<a class="sourceLine" id="cb5-311" data-line-number="311">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">19</span><span class="op">:</span><span class="dv">58</span>] Building package</a>
<a class="sourceLine" id="cb5-312" data-line-number="312"><span class="st">'/Library/Frameworks/R.framework/Resources/bin/R'</span> <span class="op">--</span>no<span class="op">-</span>site<span class="op">-</span>file  \</a>
<a class="sourceLine" id="cb5-313" data-line-number="313">  <span class="op">--</span>no<span class="op">-</span>environ <span class="op">--</span>no<span class="op">-</span>save <span class="op">--</span>no<span class="op">-</span>restore <span class="op">--</span>quiet CMD build  \</a>
<a class="sourceLine" id="cb5-314" data-line-number="314">  <span class="st">'/private/var/folders/jh/x0h3v3pd4dd497g3gtzsm8500000gn/T/RtmpHrauiV/mtcars20'</span>  \</a>
<a class="sourceLine" id="cb5-315" data-line-number="315">  <span class="op">--</span>no<span class="op">-</span>resave<span class="op">-</span>data <span class="op">--</span>no<span class="op">-</span>manual <span class="op">--</span>no<span class="op">-</span>build<span class="op">-</span>vignettes </a>
<a class="sourceLine" id="cb5-316" data-line-number="316"></a>
<a class="sourceLine" id="cb5-317" data-line-number="317">Reloading installed mtcars20</a>
<a class="sourceLine" id="cb5-318" data-line-number="318">Next Steps </a>
<a class="sourceLine" id="cb5-319" data-line-number="319"><span class="fl">1.</span> Update your package documentation. </a>
<a class="sourceLine" id="cb5-320" data-line-number="320">   <span class="op">-</span><span class="st"> </span>Edit the documentation.R file <span class="cf">in</span> the package source data<span class="op">-</span>raw subdirectory and update the roxygen markup. </a>
<a class="sourceLine" id="cb5-321" data-line-number="321">   <span class="op">-</span><span class="st"> </span>Rebuild the package documentation with  <span class="kw">document</span>() . </a>
<a class="sourceLine" id="cb5-322" data-line-number="322"><span class="fl">2.</span> Add your package to source control. </a>
<a class="sourceLine" id="cb5-323" data-line-number="323">   <span class="op">-</span><span class="st"> </span>Call  git init .  <span class="cf">in</span> the package source root directory. </a>
<a class="sourceLine" id="cb5-324" data-line-number="324">   <span class="op">-</span><span class="st">  </span>git add  the package files. </a>
<a class="sourceLine" id="cb5-325" data-line-number="325">   <span class="op">-</span><span class="st">  </span>git commit  your new package. </a>
<a class="sourceLine" id="cb5-326" data-line-number="326">   <span class="op">-</span><span class="st"> </span>Set up a github repository <span class="cf">for</span> your pacakge. </a>
<a class="sourceLine" id="cb5-327" data-line-number="327">   <span class="op">-</span><span class="st"> </span>Add the github repository as a remote of your local package repository. </a>
<a class="sourceLine" id="cb5-328" data-line-number="328">   <span class="op">-</span><span class="st">  </span>git push  your local repository to gitub. </a>
<a class="sourceLine" id="cb5-329" data-line-number="329">[<span class="dv">1</span>] <span class="st">&quot;/private/var/folders/jh/x0h3v3pd4dd497g3gtzsm8500000gn/T/RtmpHrauiV/mtcars20_1.0.tar.gz&quot;</span></a></code></pre></div>
<div id="documenting-your-data-set-changes-in-news.md" class="section level3">
<h3>Documenting your data set changes in NEWS.md</h3>
<p>When you build a package in interactive mode, you will be prompted to input text describing the changes to your data package (one line).</p>
<p>These will appear in the NEWS.md file in the following format:</p>
<pre><code>DataVersion: xx.yy.zz
========
A description of your changes to the package

[The rest of the file]</code></pre>
</div>
<div id="why-not-just-use-r-cmd-build" class="section level3">
<h3>Why not just use R CMD build?</h3>
<p>If the processing script is time consuming or the data set is particularly large, then <code>R CMD build</code> would run the code each time the package is installed. In such cases, raw data may not be available, or the environment to do the data processing may not be set up for each user of the data. DataPackageR decouples data processing from package building/installation for data consumers.</p>
</div>
<div id="a-log-of-the-build-process" class="section level3">
<h3>A log of the build process</h3>
<p>DataPackageR uses the <code>futile.logger</code> pagckage to log progress.</p>
<p>If there are errors in the processing, the script will notify you via logging to console and to <code>/private/tmp/Test/inst/extdata/Logfiles/processing.log</code>. Errors should be corrected and the build repeated.</p>
<p>If everything goes smoothly, you will have a new package built in the parent directory.</p>
<p>In this case we have a new package <code>mtcars20_1.0.tar.gz</code>.</p>
</div>
<div id="a-note-about-the-package-source-directory-after-building." class="section level3">
<h3>A note about the package source directory after building.</h3>
<p>The pacakge source directory changes after the first build.</p>
<pre><code>                         levelName
1  mtcars20                       
2   ¦--data                       
3   ¦   °--cars_over_20.rda       
4   ¦--data-raw                   
5   ¦   ¦--documentation.R        
6   ¦   °--subsetCars.Rmd         
7   ¦--DATADIGEST                 
8   ¦--datapackager.yml           
9   ¦--DESCRIPTION                
10  ¦--inst                       
11  ¦   ¦--doc                    
12  ¦   ¦   ¦--subsetCars.html    
13  ¦   ¦   °--subsetCars.Rmd     
14  ¦   °--extdata                
15  ¦       °--Logfiles           
16  ¦           ¦--processing.log 
17  ¦           °--subsetCars.html
18  ¦--man                        
19  ¦   ¦--cars_over_20.Rd        
20  ¦   °--mtcars20.Rd            
21  ¦--NAMESPACE                  
22  ¦--NEWS.md                    
23  ¦--R                          
24  ¦   °--mtcars20.R             
25  ¦--Read-and-delete-me         
26  °--vignettes                  
27      °--subsetCars.Rmd         </code></pre>
</div>
<div id="update-the-autogenerated-documentation." class="section level3">
<h3>Update the autogenerated documentation.</h3>
<p>After the first build, the <code>R</code> directory contains <code>mtcars.R</code> that has autogenerated <code>roxygen2</code> markup documentation for the data package and for the packaged data <code>cars_over20</code>.</p>
<p>The processed <code>Rd</code> files can be found in <code>man</code>.</p>
<p>The autogenerated documentation source is in the <code>documentation.R</code> file in <code>data-raw</code>.</p>
<p>You should update this file to properly document your objects. Then rebuild the documentation:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">document</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(),<span class="st">&quot;mtcars20&quot;</span>))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">INFO [<span class="dv">2018-08-01</span> <span class="dv">11</span><span class="op">:</span><span class="dv">20</span><span class="op">:</span><span class="dv">00</span>] Rebuilding data package documentation.</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">Loading mtcars20</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">[<span class="dv">1</span>] <span class="ot">TRUE</span></a></code></pre></div>
<p>This is done without reprocessing the data.</p>
<div id="dont-forget-to-rebuild-the-package." class="section level4">
<h4>Dont’ forget to rebuild the package.</h4>
<p>You should update the documentation in <code>R/mtcars.R</code>, then call <code>package_build()</code> again.</p>
</div>
</div>
</div>
<div id="installing-and-using-the-new-data-package" class="section level2">
<h2>Installing and using the new data package</h2>
<div id="accessing-vignettes-data-sets-and-data-set-documentation." class="section level3">
<h3>Accessing vignettes, data sets, and data set documentation.</h3>
<p>The package source also contains files in the <code>vignettes</code> and <code>inst/doc</code> directories that provide a log of the data processing.</p>
<p>When the package is installed, these will be accessible via the <code>vignette()</code> API.</p>
<p>The vignette will detail the processing performed by the <code>subsetCars.Rmd</code> processing script.</p>
<p>The data set documentation will be accessible via <code>?cars_over_20</code>, and the data sets via <code>data()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Let's use the package we just created.</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(),<span class="st">&quot;mtcars20_1.0.tar.gz&quot;</span>), <span class="dt">type =</span> <span class="st">&quot;source&quot;</span>, <span class="dt">repos =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;package:mtcars20&quot;</span><span class="op">%in%</span><span class="kw">search</span>())</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="kw">attachNamespace</span>(<span class="st">'mtcars20'</span>) <span class="co">#use library() in your code</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">data</span>(<span class="st">&quot;cars_over_20&quot;</span>) <span class="co"># load the data</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">cars_over_<span class="dv">20</span> <span class="co"># now we can use it.</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">   speed dist</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="dv">44</span>    <span class="dv">22</span>   <span class="dv">66</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="dv">45</span>    <span class="dv">23</span>   <span class="dv">54</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="dv">46</span>    <span class="dv">24</span>   <span class="dv">70</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="dv">47</span>    <span class="dv">24</span>   <span class="dv">92</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="dv">48</span>    <span class="dv">24</span>   <span class="dv">93</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="dv">49</span>    <span class="dv">24</span>  <span class="dv">120</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="dv">50</span>    <span class="dv">25</span>   <span class="dv">85</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16">?cars_over_<span class="dv">20</span> <span class="co"># See the documentation you wrote in data-raw/documentation.R.</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb9-18" data-line-number="18">vignettes &lt;-<span class="st"> </span><span class="kw">vignette</span>(<span class="dt">package =</span> <span class="st">&quot;mtcars20&quot;</span>)</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">vignettes<span class="op">$</span>results</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">      Package   </a>
<a class="sourceLine" id="cb9-21" data-line-number="21">Topic <span class="st">&quot;mtcars20&quot;</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22">      LibPath                                                         </a>
<a class="sourceLine" id="cb9-23" data-line-number="23">Topic <span class="st">&quot;/Library/Frameworks/R.framework/Versions/3.5/Resources/library&quot;</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">      Item         Title                                            </a>
<a class="sourceLine" id="cb9-25" data-line-number="25">Topic <span class="st">&quot;subsetCars&quot;</span> <span class="st">&quot;A Test Document for DataPackageR (source, html)&quot;</span></a></code></pre></div>
</div>
<div id="using-the-dataversion" class="section level3">
<h3>Using the DataVersion</h3>
<p>Your downstream data analysis can depend on a specific version of the data in your data package by tesing the DataVersion string in the DESCRIPTION file.</p>
<p>We provide an API for this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># We can easily check the version of the data</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">DataPackageR<span class="op">::</span><span class="kw">data_version</span>(<span class="st">&quot;mtcars20&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">[<span class="dv">1</span>] <span class="st">'0.1.0'</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co"># You can use an assert to check the data version in  reports and</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co"># analyses that use the packaged data.</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw">assert_data_version</span>(<span class="dt">data_package_name =</span> <span class="st">&quot;mtcars20&quot;</span>,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">                    <span class="dt">version_string =</span> <span class="st">&quot;0.1.0&quot;</span>,</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">                    <span class="dt">acceptable =</span> <span class="st">&quot;equal&quot;</span>)  <span class="co">#If this fails, execution stops</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">                                           <span class="co">#and provides an informative error.</span></a></code></pre></div>
</div>
</div>
<div id="migrating-old-data-packages." class="section level1">
<h1>Migrating old data packages.</h1>
<p>Version 1.12.0 has moved away from controlling the build process using <code>datasets.R</code> and an additional <code>masterfile</code> argument.</p>
<p>The build process is now controlled via a <code>datapackager.yml</code> configuration file located in the package root directory. (see <a href="YAML_CONFIG.md">YAML Configuration Details</a>)</p>
<div id="create-a-datapackager.yml-file" class="section level3">
<h3>Create a datapackager.yml file</h3>
<p>You can migrate an old package by constructing such a config file using the <code>construct_yml_config()</code> API.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># assume I have file1.Rmd and file2.R located in /data-raw, </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co"># and these create 'object1' and 'object2' respectively.</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">configuration<span class="op">:</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span>files<span class="op">:</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">    </span>file1.Rmd<span class="op">:</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">      </span>enabled<span class="op">:</span><span class="st"> </span>yes</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">    file2.R<span class="op">:</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="st">      </span>enabled<span class="op">:</span><span class="st"> </span>yes</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  objects<span class="op">:</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">  </span><span class="op">-</span><span class="st"> </span>object1</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">  <span class="op">-</span><span class="st"> </span>object2</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">  render_root<span class="op">:</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="st">    </span>tmp<span class="op">:</span><span class="st"> '560209'</span></a></code></pre></div>
<p><code>config</code> is a newly constructed yaml configuration object. It can be written to the package directory:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">path_to_package &lt;-<span class="st"> </span><span class="kw">tempdir</span>() <span class="co">#e.g., if tempdir() was the root of our package.</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">yml_write</span>(config, <span class="dt">path =</span> path_to_package)</a></code></pre></div>
<p>Now the package at <code>path_to_package</code> will build with version 1.12.0 or greater.</p>
</div>
<div id="reading-data-sets-from-rmd-files" class="section level3">
<h3>Reading data sets from Rmd files</h3>
<p>In versions prior to 1.12.1 we would read data sets from <code>inst/extdata</code> in an <code>Rmd</code> script using paths relative to <code>data-raw</code> in the data package source tree.</p>
<p>For example:</p>
<div id="the-old-way" class="section level4">
<h4>The old way</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># read 'myfile.csv' from inst/extdata relative to data-raw where the Rmd is rendered.</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">read.csv</span>(<span class="kw">file.path</span>(<span class="st">&quot;../inst/extdata&quot;</span>,<span class="st">&quot;myfile.csv&quot;</span>))</a></code></pre></div>
<p>Now <code>Rmd</code> and <code>R</code> scripts are processed in <code>render_root</code> defined in the yaml config.</p>
<p>To read a raw data set we can get the path to the package source directory using an API call:</p>
</div>
<div id="the-new-way" class="section level4">
<h4>The new way</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># DataPackageR::project_extdata_path() returns the path to the data package inst/extdata subdirectory directory.</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co"># DataPackageR::project_path() returns the path to the data package root directory.</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co"># DataPackageR::project_data_path() returns the path to the data package data subdirectory directory.</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">read.csv</span>(</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">    DataPackageR<span class="op">::</span><span class="kw">project_extdata_path</span>(<span class="st">&quot;myfile.csv&quot;</span>)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    )</a></code></pre></div>
</div>
</div>
</div>
<div id="partial-builds" class="section level1">
<h1>Partial builds</h1>
<p>We can also perform partial builds of a subset of files in a package by toggling the <code>enabled</code> key in the config file.</p>
<p>This can be done with the following API:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">config &lt;-<span class="st"> </span><span class="kw">yml_disable_compile</span>(config,<span class="dt">filenames =</span> <span class="st">&quot;file2.R&quot;</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">yml_write</span>(config, <span class="dt">path =</span> path_to_package) <span class="co"># write modified yml to the package.</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">configuration<span class="op">:</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span>files<span class="op">:</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">    </span>file1.Rmd<span class="op">:</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">      </span>enabled<span class="op">:</span><span class="st"> </span>yes</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">    file2.R<span class="op">:</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="st">      </span>enabled<span class="op">:</span><span class="st"> </span>no</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">  objects<span class="op">:</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="st">  </span><span class="op">-</span><span class="st"> </span>object1</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">  <span class="op">-</span><span class="st"> </span>object2</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">  render_root<span class="op">:</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="st">    </span>tmp<span class="op">:</span><span class="st"> '560209'</span></a></code></pre></div>
<p>Note that the modified configuration needs to be written back to the package source directory in order for the changes to take effect.</p>
<p>The consequence of toggling a file to <code>enable: no</code> is that it will be skipped when the package is rebuilt, but the data will still be retained in the package, and the documentation will not be altered.</p>
<p>This is useful in situations where we have multiple data sets, and want to re-run one script to update a specific data set, but not the other scripts because they may be too time consuming, for example.</p>
</div>
<div id="multi-script-pipelines." class="section level1">
<h1>Multi-script pipelines.</h1>
<p>We may have situations where we have mutli-script pipelines. There are two ways to share data among scripts.</p>
<ol style="list-style-type: decimal">
<li>filesystem artifacts</li>
<li>data objects passed to subsequent scripts.</li>
</ol>
<div id="file-system-artifacts" class="section level3">
<h3>File system artifacts</h3>
<p>The yaml configuration property <code>render_root</code> specifies the working directory where scripts will be rendered.</p>
<p>If a script writes files to the working directory, that is where files will appear. These can be read by subsequent scripts.</p>
</div>
<div id="passing-data-objects-to-subsequent-scripts." class="section level3">
<h3>Passing data objects to subsequent scripts.</h3>
<p>A script (e.g., <code>script2.Rmd</code>) running after <code>script1.Rmd</code> can access a stored data object named <code>script1_dataset</code> created by <code>script1.Rmd</code> by calling</p>
<p><code>DataPackageR::datapackager_object_read(&quot;script1_dataset&quot;)</code>.</p>
<p>Passing of data objects amongst scripts can be turned off via:</p>
<p><code>package_build(deps = FALSE)</code></p>
</div>
</div>
<div id="next-steps" class="section level1">
<h1>Next steps</h1>
<p>We recommend the following once your package is created.</p>
<div id="place-your-package-under-source-control" class="section level2">
<h2>Place your package under source control</h2>
<p>You now have a data package source tree.</p>
<ul>
<li><strong>Place your package under version control</strong>
<ol style="list-style-type: decimal">
<li>Call <code>git init</code> in the package source root to initialize a new git repository.</li>
<li><a href="https://help.github.com/articles/create-a-repo/">Create a new repository for your data package on github</a>.</li>
<li>Push your local package repository to <code>github</code>. <a href="https://help.github.com/articles/adding-an-existing-project-to-github-using-the-command-line/">see step 7</a></li>
</ol></li>
</ul>
<p>This will let you version control your data processing code, and provide a mechanism for sharing your package with others.</p>
<p>For more details on using git and github with R, there is an excellent guide provided by Jenny Bryan: <a href="http://happygitwithr.com/">Happy Git and GitHub for the useR</a> and Hadley Wickham’s <a href="http://r-pkgs.had.co.nz/">book on R packages</a>.</p>
</div>
</div>
<div id="additional-details" class="section level1">
<h1>Additional Details</h1>
<p>We provide some additional details for the interested.</p>
<div id="fingerprints-of-stored-data-objects" class="section level3">
<h3>Fingerprints of stored data objects</h3>
<p>DataPackageR calculates an md5 checksum of each data object it stores, and keeps track of them in a file called <code>DATADIGEST</code>.</p>
<ul>
<li>Each time the package is rebuilt, the md5 sums of the new data objects are compared against the DATADIGEST.</li>
<li>If they don’t match, the build process checks that the <code>DataVersion</code> string has been incremented in the <code>DESCRIPTION</code> file.</li>
<li>If it has not the build process will exit and produce an error message.</li>
</ul>
<div id="datadigest" class="section level4">
<h4>DATADIGEST</h4>
<p>The <code>DATADIGEST</code> file contains the following:</p>
<pre><code>DataVersion: 0.1.0
cars_over_20: 3ccb5b0aaa74fe7cfc0d3ca6ab0b5cf3</code></pre>
</div>
<div id="description" class="section level4">
<h4>DESCRIPTION</h4>
<p>The description file has the new <code>DataVersion</code> string.</p>
<pre><code>Package: mtcars20
Version: 1.0
Title: What the Package Does (One Line, Title Case)
Description: What the package does (one paragraph).
Authors@R: person(&quot;First&quot;, &quot;Last&quot;, email = &quot;first.last@example.com&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;))
License: What license is it under?
Encoding: UTF-8
LazyData: true
ByteCompile: true
DataVersion: 0.1.0
Date: 2018-08-01
Suggests: 
    knitr,
    rmarkdown
VignetteBuilder: knitr
RoxygenNote: 6.1.0</code></pre>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
